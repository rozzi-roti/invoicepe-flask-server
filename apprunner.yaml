version: 1.0
runtime: python3
build:
  commands:
    build:
      - sudo yum -y update
      - sudo yum -y install gcc
      - sudo yum install -y git libtool clang gcc-c++.x86_64
      - sudo yum install -y zlib zlib-devel libjpeg libjpeg-devel libwebp libwebp-devel libtiff libtiff-devel libpng libpng-devel
      - cp /usr/lib64/libjpeg.so.62 /usr/local/lib/
      - cp /usr/lib64/libwebp.so.4 /usr/local/lib/
      - cp /usr/lib64/libtiff.so.5 /usr/local/lib/
      - cp /usr/lib64/libpng15.so.15 /usr/local/lib/
      - sudo rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
      - sudo yum -y update
      - sudo yum install -y tesseract
      - sudo yum -y install mesa-libGL
      - pip3 install --upgrade pip
      - pip3 install -y wheel
      - pip3 install --upgrade pip setuptools wheel
      - pip3 install -r requirements.txt
run:
  runtime-version: 3.8.16
  command: exec gunicorn --config config.py -w 8 --worker-class gevent --preload -b 0.0.0.0:5000 app:app
  network:
    port: 5000
  env:
    - name: JWT_SECRET
      value: a5d4beca4af862af77196bea639198463f6f8cd49294c88cb08793498fbab604
